<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Dashboard</title>
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
</head>
<body class="bg-light">
  <nav class="navbar navbar-dark bg-primary">
    <div class="container">
      <span class="navbar-brand">Loan Dashboard</span>
      <button class="btn btn-outline-light" id="logoutBtn">Logout</button>
    </div>
  </nav>

  <!-- ‚úÖ Wrap main content in a hidden div -->
  <div class="container mt-5" id="dashboardContent" style="display:none;">
    <h2 id="welcomeUser" class="mb-4">Welcome!</h2>

    <div class="row">
      <div class="col-md-6 mb-3">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title">üí∞ My Loans</h5>
            <p class="card-text">View your loan applications and their status.</p>
            <a href="myloans.html" class="btn btn-primary">View Loans</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-3">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title">‚öôÔ∏è Account Settings</h5>
            <p class="card-text">Manage your personal account details.</p>
            <a href="#" class="btn btn-secondary">Coming Soon</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Token check script (place before dashboard.js) -->
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const token = localStorage.getItem("token");

    if (!token) {
      alert("Please log in to access your dashboard.");
      window.location.href = "login.html";
      return;
    }

    // Verify token with backend
    fetch("https://loan-backend-xahc.onrender.com/api/users/test", {
      headers: { Authorization: "Bearer " + token }
    })
      .then(res => {
        if (!res.ok) throw new Error("Token invalid");
        return res.json();
      })
      .then(data => {
        console.log("‚úÖ Verified user:", data);
        document.getElementById("dashboardContent").style.display = "block";
        document.getElementById("welcomeUser").textContent = `Welcome, ${data.name || "User"}!`;
      })
      .catch(err => {
        console.error("‚ùå Invalid or expired token:", err);
        localStorage.removeItem("token");
        alert("Session expired. Please log in again.");
        window.location.href = "login.html";
      });

    // Logout button
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("token");
      alert("Logged out successfully.");
      window.location.href = "index.html";
    });
  });
  </script>

  <!-- Your existing script -->
  <script src="js/dashboard.js"></script>
</body>
</html>
